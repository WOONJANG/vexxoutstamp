<!DOCTYPE html>
<html lang="ko">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>이동 중…</title>
<script>
  // 당신의 Apps Script /exec 주소
  const GAS_BASE = "https://script.google.com/macros/s/AKfycbxd1YCczjU-lW1fshL7gaiDT5eRWNKBBk_TVKTosvOhxot1u7eUBVwR2Hd3tBs9qs6XbA/exec";

  const qp  = new URLSearchParams(location.search);
  const u   = qp.get('u')   || '';
  const act = qp.get('act') || 'out';
  const ua  = navigator.userAgent || '';

  function go(target) {
    try { window.top.location.replace(target); } catch(e) { location.replace(target); }
    document.write('<noscript><meta http-equiv="refresh" content="0;url='+target+'"></noscript>');
  }

  (async function () {
    if (!u) {
      document.write("<div style='font:14px system-ui;padding:24px'>이름 파라미터(u)가 필요합니다.</div>");
      return;
    }

    // (선택) 공인 IP 조회 — 실패해도 UA만으로 진행
    let ip = '';
    try {
      const ctl = new AbortController();
      const t = setTimeout(() => ctl.abort(), 1200); // 1.2초 타임아웃
      const res = await fetch('https://api.ipify.org?format=json', {signal: ctl.signal});
      clearTimeout(t);
      if (res.ok) ip = (await res.json()).ip || '';
    } catch (_) {}

    const qs = new URLSearchParams({
      u, act,
      ua,           // UA를 쿼리로 전달
      ...(ip ? {ip} : {}) // IP가 있으면 전달
    });

    go(GAS_BASE + '?' + qs.toString());
  })();
</script>
<style>
  html,body { height:100%; margin:0 }
  body { display:grid; place-items:center; font:14px system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif }
</style>
<body>
  <div>퇴근 기록 페이지로 이동 중…</div>
</body>
</html>
